<geometry>

    <!-- ========================================================
         GLOBAL PARAMETERS
         ======================================================== -->
    <define name="photocathode_radius"  value="{5.e-4}"/>
    <define name="photocathode_height" value="{5.e-3}"/>

    <define name="frontelectrode_radius"  value="{5.e-4}"/>
    <define name="frontelectrode_height" value="{2.5e-3}"/>

    <!-- distance in XY plane from photocathode axis -->
    <define name="electrode_offset" value="{1.e-3}"/>

    <!-- mesh parameters -->
    <define name="rs_egun_arc_count"   value="25"/>
    <define name="rs_egun_mesh_scale"  value="5"/>
    <define name="rs_egun_mesh_power"  value="1"/>


    <!-- ========================================================
         BASE SURFACES (photocathode + electrode)
         ======================================================== -->

    <cylinder_surface name="photocathode_surface" 
        z1="0."
        z2="{[photocathode_height]/2}"
        r="[photocathode_radius]"
        longitudinal_mesh_count="[rs_egun_mesh_scale]"
        longitudinal_mesh_power="[rs_egun_mesh_power]"
        axial_mesh_count="[rs_egun_arc_count]"
    />

    <disk_surface name="photocathode_disk_surface"
        z="0"
        r="[photocathode_radius]"
        radial_mesh_count="14"
        radial_mesh_power="5"
        axial_mesh_count="20"
    />

    <cylinder_surface name="frontelctrode_surface"
        z1="0."
        z2="[frontelectrode_height]"
        r="[frontelectrode_radius]"
        longitudinal_mesh_count="[rs_egun_mesh_scale]"
        longitudinal_mesh_power="[rs_egun_mesh_power]"
        axial_mesh_count="[rs_egun_arc_count]"
    />

    <disk_surface name="frontelectrode_disk_surface"
        z="0"
        r="[frontelectrode_radius]"
        radial_mesh_count="14"
        radial_mesh_power="5"
        axial_mesh_count="20"
    />


    <!-- ========================================================
         ONE SINGLE SPACE: All three components inside
         ======================================================== -->
    <space name="egun_space">

        <!-- ====================================================
             1) Photocathode centered on Z axis
             ==================================================== -->
        <surface name="photocathode_disk"
                 node="photocathode_disk_surface">
            <transformation displacement="0. 0. 0."/>
        </surface>

        <surface name="photocathode_cylinder"
                 node="photocathode_surface">
            <transformation displacement="0. 0. 0."/>
        </surface>


        <!-- ====================================================
             2) FRONT ELECTRODE AT +X  (1 mm away)
             Lying in XY plane -> rotate 90° around Y axis
             ==================================================== -->
        <transformation
            displacement="[electrode_offset] 0. 0."
            rotation_euler="0. 90. 0."
        />

        <surface name="front_plusX_disk_bottom"
                 node="frontelectrode_disk_surface">
            <transformation displacement="0. 0. 0."/>
        </surface>

        <surface name="front_plusX_cylinder"
                 node="frontelctrode_surface">
            <transformation displacement="0. 0. 0."/>
        </surface>

        <surface name="front_plusX_disk_top"
                 node="frontelectrode_disk_surface">
            <transformation displacement="0. 0. [frontelectrode_height]"/>
        </surface>


        <!-- ====================================================
             3) FRONT ELECTRODE AT −X  (mirror copy)
             Same rotation, opposite displacement
             ==================================================== -->
        <transformation
            displacement="-[electrode_offset] 0. 0."
            rotation_euler="0. 90. 0."
        />

        <surface name="front_minusX_disk_bottom"
                 node="frontelectrode_disk_surface">
            <transformation displacement="0. 0. 0."/>
        </surface>

        <surface name="front_minusX_cylinder"
                 node="frontelctrode_surface">
            <transformation displacement="0. 0. 0."/>
        </surface>

        <surface name="front_minusX_disk_top"
                 node="frontelectrode_disk_surface">
            <transformation displacement="0. 0. [frontelectrode_height]"/>
        </surface>

    </space>

</geometry>
